---
title: 访问远程服务
date: 2022-12-22 17:06:25
tags: rpc
categoriesa: 架构
---

远程服务将计算机程序的工作范围从单机扩展到网络，从本地延伸至远程，是构建分布式系统的首要基础。

## 远程服务调用

[RPC](https://en.wikipedia.org/wiki/Remote_procedure_call) 的全称是 Remote Procedure Call（远程过程调用）是一种**进程间通信**方式，即允许程序调用另一个地址空间（通常是共享网络的另一台机器上）的过程或函数，而不用程序员显式编码这个远程调用的细节。 无论是调用本地的还是远程的，本质上编写的调用代码基本相同。

### 进程间调用

RPC的主要一个目的即为了让计算机能够跟调用本地方法一样去调用远程方法。

#### 本地调用

本地程序如果是调用方Caller调用提供方Callee，将会使用<u>当前进程的内存地址空间</u>。从参数Parameter传递、确定Callee版本、执行Callee方法、返回结果Response给Caller。

#### 远程调用

远程调用指调用方Caller调用非同一进程提供方Callee的方法，面临最大的障碍是参数如何传递和结果如何返回，即两个进程间如何交换数据（进程间通信IPC）。

- 管道（Pipe）：管道类似于两个进程间的桥梁，可通过管道在进程间传递少量的字符流或字节流。
- 信号（Signal）：信号用于通知目标进程有某种事件发生，除了用于进程间通信外，进程还可以发送信号给进程自身。
- 信号量（Semaphore）：信号量用于两个进程之间同步协作手段，它相当于操作系统提供的一个特殊变量。
- 消息队列（MQ）：进程可以向队列添加消息，被赋予读权限的进程则可以从队列消费消息。
- 共享内存（Shared Memory）：允许多个进程访问同一块公共的内存空间，这是效率最高的进程间通信形式。
- 套接字接口（Socket）：消息队列和共享内存只适合单机多进程间的通信，套接字接口是更为普适的进程间通信机制，可用于不同机器之间的进程通信。

### PRC

[RPC](http://www.bitsavers.org/pdf/xerox/parc/techReports/CSL-81-9_Remote_Procedure_Call.pdf)：远程服务调用是指位于互不重合的内存地址空间中的两个程序，在语言层面上，以同步的方式使用带宽有限的信道来传输程序控制信息。

<img src="http://cdn.expiredunclecoder.tech/image-20221223090207083.png" alt="image-20221223090207083" style="zoom: 33%;" />

#### 特点

RPC 的主要目标是让构建分布式计算（应用）更容易，在提供强大的远程调用能力时不损失本地调用的语义简洁性。 为实现该目标，RPC 框架需提供一种透明调用机制让使用者不必显式的区分本地调用和远程调用。

#### 三个问题

1. 如何表示数据：包括了传递给方法的参数，以及方法执行后的返回值。有效的做法是将交互双方所涉及的数据转换为某种事先约定好的中立数据流格式来进行传输，将数据流转换回不同语言中对应的数据类型来进行使用，就是**序列化与反序列化**。
2. 如何传递数据：是指如何通过网络，在两个服务的 Endpoint 之间相互操作、交换数据。通常指的是应用层协议，实际传输一般是基于标准的 TCP、UDP 等标准的传输层协议来完成的。
3. 如何确定方法：语言无关的接口描述语言 （Interface Description Language，IDL）定位方法。

#### 调用模型

<img src="https://pic1.zhimg.com/c50b94be18a05b9992790f16baf0fb74_r.jpg" alt="img" style="zoom: 33%;" />

- RpcClient：
- RpcServer：
- RpcProxy：
- RpcInvoker:
- PrcProtocol:

#### 常用框架

Thrift：

gRPC：

Dubbo：

Spring Cloud：